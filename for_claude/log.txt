================================================================================
プロジェクトログ - 三菱様_多言語翻訳_202510
================================================================================
最終更新: 2025-01-24 (Phase 8完了)

================================================================================
プロジェクト概要
================================================================================

目的: 建設関連職種の多言語辞書PDFから表データを抽出し、CSV形式で保存・加工

対象言語:
  - 日本語（基準）
  - 英語、タガログ語、中国語、タイ語、ベトナム語、ミャンマー語、インドネシア語、カンボジア語

================================================================================
完了済みタスク
================================================================================

Phase 1: PDF抽出（完了）
  - pdfplumberを使用してPDFから表データを抽出
  - 8言語のPDFファイルから個別CSVを作成
  - 出力: output/[言語名]_pdfplumber_抽出_最終版.csv

Phase 2: データ統合（完了）
  - 全言語のCSVを統合してlong形式のCSVを作成
  - 出力: output/全言語統合_pdfplumber_最終版.csv
  - 総行数: 4,010行（日本語523 + 8言語の翻訳）

Phase 3: ピボット変換（完了）
  - long形式からwide形式に変換（pivot）
  - 各行が日本語単語、各列が言語
  - 出力: output/全言語統合_テンプレート形式.csv

Phase 4: データ並び替え（完了）
  - ベトナム語の順序をカテゴリとして使用
  - ベトナム語固有の512語 + 他言語固有の12語 = 524語
  - 全データを保持しながら並び替え
  - 出力: output/全言語統合_テンプレート形式_ベトナム語並び順.csv

Phase 5: テンプレート作成（完了）
  - インポート用に必要な列のみをフィルター
  - 列: ja, en, fil-PH, zh, th, vi, my, id, km（9列）
  - 出力: output/全言語統合_テンプレート_インポート用.csv
  - サイズ: 524行 x 9列

Phase 6: 逆翻訳検証（完了）
  - Google Translate API を使用して各言語を日本語に逆翻訳
  - 翻訳品質の確認
  - 出力: output/逆翻訳_検証結果.xlsx
    - inputシート: 元の翻訳データ
    - outputシート: 逆翻訳結果
  - 処理数: 約4,000件の翻訳

Phase 7: ファイル最適化（完了）
  - for_claudeディレクトリの整理（不要なログをアーカイブ）
  - outputディレクトリの整理（中間ファイルを移動）
  - 重要ファイルのみを残す

Phase 8: Claude AI手動判定による翻訳品質評価（完了 - 2025-01-24）
  - インドネシア語の逆翻訳データを意味的に評価
  - 対象: 1,297行（869ユニークペア）
  - 処理方法:
    * 5バッチに分割（100-200ペア/バッチ）
    * Claude AIによる意味的類似度判定（0-100%）
    * ユニークペアをマッピングして全行に適用
  - 結果:
    * difflib平均: 52.3% → Claude AI平均: 96.7%
    * 改善: +44.4ポイント
    * 100%完全一致: 1,105件（85.2%）
    * 90%以上: 1,188件（91.6%）
  - 出力:
    * 比較用_インドネシア.xlsx (3シート: 翻訳/再翻訳/比較)
    * 比較_Claude手動判定_全1297行.csv
    * ユニークペア_batch1-5_claude判定.csv（中間ファイル）
  - ドキュメント:
    * for_claude/Claude手動判定プロセス_完全版.md（詳細手順）
  - 主要スクリプト:
    * scripts/create_3sheet_comparison_excel_full.py
    * scripts/claude_judgment_batch1-5_manual.py
    * scripts/merge_all_batches_manual.py

================================================================================
最終成果物
================================================================================

1. 全言語統合_テンプレート_インポート用.csv (0.12 MB)
   - 524行 x 9列
   - インポート準備完了
   - 日本語 + 8言語の翻訳

2. 逆翻訳_検証結果.xlsx (0.11 MB)
   - inputシート: 元データ
   - outputシート: 逆翻訳結果
   - 品質確認用

3. 比較用_インドネシア.xlsx (0.12 MB) ★NEW (Phase 8)
   - 翻訳シート: 元の翻訳データ (514行)
   - 再翻訳シート: 逆翻訳結果 (514行)
   - 比較シート: 詳細比較データ (1,298行)
   - インドネシア語の翻訳品質確認用

4. 比較_Claude手動判定_全1297行.csv (0.08 MB) ★NEW (Phase 8)
   - 全1,297行の意味的類似度評価
   - 列: アドレス、言語、単語、再翻訳、翻訳、一致、類似度_difflib、分類、類似度_ai、類似度_claude
   - Claude AI評価: 平均96.7%（difflib: 52.3% → +44.4ポイント改善）

================================================================================
重要な技術情報
================================================================================

CIDコード問題:
  - 57件のCIDコードが入力データに存在
  - 原因: PDF抽出時にpdfplumberが特殊文字をCIDコードとして記録
  - 分布: 英語21件、タイ語14件、カンボジア語22件
  - 種類:
    * (cid:9) = タブ文字
    * (cid:1143), (cid:544), (cid:814) = ダイアクリティカルマークや特殊文字
  - 対処: 現状維持（翻訳品質には影響なし）

翻訳品質:
  - 逆翻訳の結果、多くの翻訳が正確であることを確認
  - 一部の訳語は類義語に変換（例: "清掃" → "クリーン"）
  - 意味は保持されている

Claude AI判定による品質評価（Phase 8）:
  - difflib（文字列一致）: 平均52.3%
  - Claude AI（意味的判定）: 平均96.7%
  - 改善効果: +44.4ポイント
  - 同義語の正確な評価が可能に:
    * 清掃/クリーニング: difflib 0% → Claude 100%
    * 給料/賃金: difflib 0% → Claude 100%
    * 指導員/インストラクター: difflib 0% → Claude 100%
    * 救急箱/救急キット: difflib 14% → Claude 95%
  - 誤訳の正確な検出:
    * 支柱/ポーランド人: Claude 0%（pole/Poleの誤訳）
    * 硬さ/暴力: Claude 0%（hardness/violenceの誤訳）
  - 処理詳細: for_claude/Claude手動判定プロセス_完全版.md 参照

データ完全性:
  - 全524行のデータを保持
  - 欠損値なし（95.66%の翻訳カバレッジ）
  - ベトナム語固有: 12語
  - 他言語と共通: 512語

================================================================================
ディレクトリ構造
================================================================================

プロジェクトルート/
├── 建設関連PDF/              # 入力PDFファイル（8言語）
├── output/                   # 最終成果物
│   ├── 全言語統合_テンプレート_インポート用.csv
│   ├── 逆翻訳_検証結果.xlsx
│   └── intermediate/         # 中間ファイル（アーカイブ）
├── scripts/                  # Pythonスクリプト
│   ├── extract_tables_from_pdf.py
│   ├── unify_all_languages.py
│   ├── pivot_unified_csv.py
│   ├── reorder_template_by_vietnamese.py
│   ├── create_template_only.py
│   ├── reverse_translate_to_japanese.py
│   └── check_reverse_translation.py
├── for_claude/               # Claude用ドキュメント
│   ├── log.txt               # このファイル
│   ├── reverse_translation_analysis.txt
│   ├── input_csv_cid_check.txt
│   ├── reverse_translation_check.txt
│   ├── reverse_translation_summary.txt
│   ├── optimization_report.txt
│   └── archive/              # 古いログ
└── .venv/                    # Python仮想環境

================================================================================
使用技術
================================================================================

Python ライブラリ:
  - pdfplumber 0.11.4    : PDF抽出
  - pandas 2.2.3          : データ処理
  - openpyxl 3.1.5        : Excel処理
  - google-cloud-translate: Google Translate API
  - python-dotenv         : 環境変数管理

API:
  - Google Cloud Translation API v2 (REST)
  - 認証: APIキー（.env）

エンコーディング:
  - CSV: UTF-8 BOM
  - Python: UTF-8

================================================================================
次回のセッションへの引継ぎ事項
================================================================================

完了済み:
  ✓ PDF抽出
  ✓ データ統合
  ✓ ピボット変換
  ✓ データ並び替え
  ✓ テンプレート作成
  ✓ 逆翻訳検証
  ✓ ファイル最適化
  ✓ Claude AI手動判定による翻訳品質評価 (2025-01-24)

保留中の課題:
  - CIDコードの修正（必要に応じて）
  - PDFの再抽出（必要に応じて）

推奨次ステップ:
  1. 比較用_インドネシア.xlsx を開いて翻訳品質を確認
  2. 比較_Claude手動判定_全1297行.csv で低スコア項目を確認
  3. 他の言語（英語、中国語など）にも同じ手法を適用
  4. 全言語統合_テンプレート_インポート用.csv をシステムにインポート

次回実行時の参考資料:
  - Claude手動判定の詳細手順: for_claude/Claude手動判定プロセス_完全版.md
  - バッチ判定スクリプト: scripts/claude_judgment_batch*_manual.py
  - 統合スクリプト: scripts/merge_all_batches_manual.py

================================================================================
重要ファイルの場所
================================================================================

最終成果物:
  output/全言語統合_テンプレート_インポート用.csv
  output/逆翻訳_検証結果.xlsx
  output/比較用_インドネシア.xlsx ★NEW (Phase 8)
  output/比較_Claude手動判定_全1297行.csv ★NEW (Phase 8)

ドキュメント:
  for_claude/log.txt (このファイル)
  for_claude/reverse_translation_analysis.txt
  for_claude/input_csv_cid_check.txt
  for_claude/optimization_report.txt
  for_claude/Claude手動判定プロセス_完全版.md ★NEW (Phase 8)

主要スクリプト:
  scripts/extract_tables_from_pdf.py
  scripts/reverse_translate_to_japanese.py
  scripts/check_reverse_translation.py
  scripts/create_3sheet_comparison_excel_full.py ★NEW (Phase 8)
  scripts/claude_judgment_batch1-5_manual.py ★NEW (Phase 8)
  scripts/merge_all_batches_manual.py ★NEW (Phase 8)

設定ファイル:
  .env (APIキー - Git管理外)
  CLAUDE.md (プロジェクト設定)
  CLAUDE_GLOBAL.md (グローバル設定)

================================================================================
成果物フォルダ
================================================================================

フォルダ: 成果物_20251023/
作成日時: 2025-10-23 14:29:39

ファイル構成:
  00_README.txt                                (6.1 KB)  - 成果物の説明書
  01_全言語統合_テンプレート_インポート用.csv  (124 KB)  - メインCSV
  02_逆翻訳_検証結果.xlsx                      (117 KB)  - 品質確認用Excel
  ドキュメント_逆翻訳分析.txt                  (4.9 KB)  - 分析レポート
  ドキュメント_CID確認.txt                     (2.0 KB)  - CID詳細
  ドキュメント_プロジェクトログ.txt            (8.3 KB)  - 全体ログ

合計: 6ファイル (約252 KB)

================================================================================
プロジェクトステータス
================================================================================

現在の状態: ✓ 完了（Phase 8まで）

全フェーズ（1-8）が正常に完了しました。

【最新の成果】Phase 8 (2025-01-24):
  - インドネシア語逆翻訳データの意味的評価が完了
  - difflib: 52.3% → Claude AI: 96.7% (+44.4ポイント改善)
  - 1,297行（869ユニークペア）を5バッチで処理
  - 同義語の正確な評価（例: 清掃/クリーニング 100%）
  - 誤訳の正確な検出（例: 支柱/ポーランド人 0%）

成果物:
  - 比較用_インドネシア.xlsx (3シート)
  - 比較_Claude手動判定_全1297行.csv
  - 詳細手順書: for_claude/Claude手動判定プロセス_完全版.md

次回セッションでは:
  - 他の言語（英語、中国語など）にも同じ手法を適用可能
  - 手順書に従って再現可能

================================================================================
