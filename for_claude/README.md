# for_claude/ フォルダガイド

このフォルダには、Claude Codeセッション間の引継ぎ情報が保存されています。

## 📑 最重要ドキュメント

### 1. **log.txt** 🔥 必読
プロジェクト全体の履歴と現在の状態を記録した総合ログファイル。

**内容**:
- Phase 1-8の完了履歴
- 最新の成果（Phase 8: Claude AI手動判定による翻訳品質評価）
- 重要な技術情報（CIDコード問題、翻訳品質評価など）
- 次回セッションへの引継ぎ事項
- 重要ファイルの場所

**使い方**:
新しいセッション開始時に必ず読んでプロジェクトの状況を把握する。

---

### 2. **Claude手動判定プロセス_完全版.md** 🔥 Phase 8重要
Claude AIによる意味的類似度判定の完全な手順書（Phase 8の成果）。

**内容**:
- 処理フロー全体
- ステップバイステップの詳細手順
- 判定基準（同義語=100%、誤訳=0%など）
- バッチ処理方法
- トラブルシューティング
- 次回実行時のチェックリスト

**使い方**:
他の言語（英語、中国語など）でも同じ手法を適用する際に参照する。

**成果**:
- difflib: 52.3% → Claude AI: 96.7% (+44.4ポイント改善)
- 1,297行（869ユニークペア）を処理

---

### 3. **エラー対処法.md** ⚠️ トラブル時参照
プロジェクトで発生したエラーと解決方法の完全ガイド。

**主な内容**:
1. UnicodeEncodeError (`'cp932' codec can't encode character`)
2. TypeError (TableFinderオブジェクトのlen()エラー)
3. ValueError (列数の不一致)
4. AttributeError (DataFrameにfind_tables属性がない)
5. **CIDコード問題** (pdfplumberの特殊文字抽出問題)

**使い方**:
エラーが発生した際に該当する番号を参照して解決方法を確認する。

---

### 4. **CIDコード解決策.md** 📌 CID問題専用
CIDコード問題の原因と解決策の詳細分析。

**主な内容**:
- CIDコードとは何か
- pdfplumberとPyMuPDFの違い
- 3つの解決策の比較
- 推奨アプローチ

**結論**: PyMuPDFを使用することでCIDコード問題を回避可能。

---

### 5. **CID問題のベストプラクティス調査結果.md** 📊 CID問題詳細調査
CID問題に対する業界のベストプラクティスと実装方法。

**主な内容**:
- ToUnicode CMapの活用方法
- PDFフォント埋め込み確認方法
- 複数ライブラリの併用戦略
- カンボジア語・タイ語での実装例

---

## 📁 フォルダ構成

```
for_claude/
├── README.md                                    (このファイル)
├── log.txt                                      [最重要] プロジェクト総合ログ
├── Claude手動判定プロセス_完全版.md             [重要] Phase 8手順書
├── エラー対処法.md                              [重要] エラー解決ガイド
├── CIDコード解決策.md                           CID問題解決策
├── CID問題のベストプラクティス調査結果.md       CID問題詳細調査
└── archive/                                     古いドキュメント（参考用）
    ├── comparison_*.txt/csv
    ├── excel_*.json/txt
    ├── file_*.txt
    ├── log_session_*.txt
    ├── pdf_*.txt
    ├── pymupdf_*.txt
    ├── reverse_translation_*.txt/log
    └── その他古いファイル
```

---

## 🚀 次回セッション開始時の手順

### 1. 状況確認 (5分)
```
1. log.txt を読む
   - プロジェクトの現在の状態を把握
   - 完了済みのPhaseを確認（Phase 1-8完了）
   - 次のタスクを確認

2. 最新の成果を確認
   - Phase 8: Claude AI手動判定（インドネシア語）
   - 出力ファイル:
     * output/比較用_インドネシア.xlsx
     * output/比較_Claude手動判定_全1297行.csv
```

### 2. ユーザーの要望に応じた作業
```
例1: 他の言語でも同じ評価を実施したい
   → Claude手動判定プロセス_完全版.md を参照

例2: エラーが発生した
   → エラー対処法.md を参照

例3: CIDコード問題が再発した
   → CIDコード解決策.md を参照
```

---

## 💡 よくある質問

### Q1: プロジェクトの現在の状態は？
**A**: Phase 1-8が完了。最新はPhase 8（Claude AI手動判定）。
- インドネシア語の翻訳品質評価済み
- 平均類似度: 96.7%（difflib: 52.3% → +44.4ポイント改善）

### Q2: 次に何をすべき？
**A**: log.txt の「推奨次ステップ」セクションを参照。
- 他の言語にも同じ手法を適用
- 低スコア項目の確認と改善

### Q3: CIDコード問題が発生したら？
**A**: CIDコード解決策.md を参照。推奨はPyMuPDFの使用。

### Q4: エラーが発生したら？
**A**: エラー対処法.md の該当する番号を参照。

### Q5: Phase 8の手法を他の言語に適用するには？
**A**: Claude手動判定プロセス_完全版.md を参照。
- バッチ分割（200件/バッチ）
- Claude AIによる意味的判定
- 統合スクリプトで全行にマッピング

---

## 📊 プロジェクトの主要成果

### Phase 8 (最新 - 2025-01-24)
- **目的**: インドネシア語逆翻訳の意味的品質評価
- **手法**: Claude AIによる手動判定（5バッチ、869ユニークペア）
- **成果**: difflib 52.3% → Claude AI 96.7% (+44.4ポイント)
- **出力**:
  - 比較用_インドネシア.xlsx (3シート)
  - 比較_Claude手動判定_全1297行.csv
- **詳細**: Claude手動判定プロセス_完全版.md

### Phase 1-7
- PDF抽出、データ統合、ピボット変換、テンプレート作成など
- 詳細: log.txt 参照

---

## 🎯 重要な概念

### Claude AI判定の利点
従来のdifflib（文字列一致）では、同義語を正しく評価できない：
- 清掃 vs クリーニング → difflib: 0% / Claude: 100%
- 給料 vs 賃金 → difflib: 0% / Claude: 100%

Claude AIによる意味的判定により、建設業界用語や専門用語の同義語を正確に評価可能。

### バッチ処理の理由
- トークン使用量の管理（Claude Code Max: 約200,000トークン/セッション）
- 100-200ペア/バッチが最適
- ユニークペアのマッピングで全行に適用（効率化）

---

## ⚙️ 技術スタック

- **Python**: 3.11
- **主要ライブラリ**:
  - pandas 2.2.3
  - pdfplumber 0.11.4（初期抽出）
  - PyMuPDF (fitz) 1.26.5（CID問題回避）
  - openpyxl 3.1.5
  - Google Cloud Translation API v2
- **エンコーディング**: UTF-8 BOM

---

## 📞 サポート

このドキュメントで解決しない場合:
1. log.txt の「次回のセッションへの引継ぎ事項」を確認
2. archive/ フォルダの古いドキュメントを検索
3. ユーザーに確認を依頼

---

**最終更新**: 2025-01-24 (Phase 8完了)
**メンテナンス**: Claude Codeセッション終了時に更新
